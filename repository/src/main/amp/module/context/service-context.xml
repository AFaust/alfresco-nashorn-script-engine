<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
    <!-- Note: All beans should be prefixed ${project.artifactId} in their ID in general -->
    <!-- Exceptions: service beans (unique name) and beans with name conventions (e.g. web scripts) -->

    <bean id="${project.artifactId}-nashornScriptEngineFactory" class="jdk.nashorn.api.scripting.NashornScriptEngineFactory" />

    <bean id="${project.artifactId}-nashornScriptEngine" factory-bean="${project.artifactId}-nashornScriptEngineFactory" factory-method="getScriptEngine">
        <constructor-arg>
            <list>
                <!-- scripting is not configurable -->
                <value>-scripting=false</value>
                
                <value>-strict=${nashornJavaScriptProcessor.nashorn.flag.strict}</value>
                <value>--const-as-var=${nashornJavaScriptProcessor.nashorn.flag.constAsVar}</value>
                
                <value>-doe=true</value>
                <value>-pcc=${nashornJavaScriptProcessor.nashorn.flag.persistentScriptCache}</value>
                <value>-ot=${nashornJavaScriptProcessor.nashorn.flag.optimisticTypes}</value>
                <value>--class-cache-size=${nashornJavaScriptProcessor.nashorn.flag.classCacheSize}</value>

                <value>--debug-lines=${nashornJavaScriptProcessor.nashorn.flag.debugLines}</value>
                <value>--debug-locals=${nashornJavaScriptProcessor.nashorn.flag.debugLocals}</value>
                
                <value>--profile-callsites=${nashornJavaScriptProcessor.nashorn.flag.profileCallsites}</value>
            </list>
        </constructor-arg>
    </bean>

    <bean id="${project.artifactId}-nashornJavaScriptProcessor" class="de.axelfaust.alfresco.nashorn.repo.processor.NashornScriptProcessor">
        <property name="engine" ref="${project.artifactId}-nashornScriptEngine" />

        <property name="scriptService" ref="scriptService" />
        <property name="namespaceService" ref="NamespaceService" />
        <property name="moduleService" ref="ModuleService" />
        <property name="globalProperties" ref="global-properties" />
        <property name="amdConfig" value="${nashornJavaScriptProcessor.amd.config}" />
        <property name="nashornGlobalPropertiesToRemove" value="${nashornJavaScriptProcessor.nashorn.global.propertiesToRemove}" />
        <property name="scriptContextWarmupCount" value="${nashornJavaScriptProcessor.nashorn.scriptContext.warmupCount}" />

        <!-- javascript is already taken by javaScriptProcessor -->
        <property name="name" value="nashorn" />
        <!-- js is already taken by javaScriptProcessor -->
        <property name="extension" value="nashornjs" />
    </bean>

    <bean id="baseNashornJavaScriptExtension" abstract="true" init-method="register">
        <property name="processor" ref="${project.artifactId}-nashornJavaScriptProcessor" />
    </bean>
</beans>
